###########################  CREAR LA TABLA CLIENT ################

-- CREAR LA TABLA CLIENTE
CREATE TABLE CLIENT
(
    ID NUMBER,
    NAME VARCHAR(4000),
    EMAIL VARCHAR2(20),
    AGE NUMBER,
    PRIMARY KEY(ID) 
);

--SECUENCIA PARA CLIENT
CREATE SEQUENCE CLIENT_SEQUENCE START WITH 1 INCREMENT BY 1;

--CREAR EL DISPARADOR PARA LA SECUENCIA CLIENT
CREATE OR REPLACE TRIGGER CLIENT_TRIGGER
    BEFORE INSERT ON MENSAJE FOR EACH ROW
    WHEN (NEW.ID IS NULL)
    BEGIN
        SELECT CLIENT_SEQUENCE.NEXTVAL INTO :NEW.ID FROM DUAL;
    END;

##############################  CREAR LA TABLA MESSAGE ################################

-- CREAR LA TABLA MENSAJE
CREATE TABLE MENSAJE
(
    ID NUMBER,
    MESSAGETEXT VARCHAR2(4000),
    PRIMARY KEY(ID) 
);

--SECUENCIA PARA CLIENT
CREATE SEQUENCE MESSAGE_SEQUENCE START WITH 1 INCREMENT BY 1;

--CREAR EL DISPARADOR PARA LA SECUENCIA CLIENT
CREATE OR REPLACE TRIGGER MESSAGE_TRIGGER
    BEFORE INSERT ON MENSAJE FOR EACH ROW
    WHEN (NEW.ID IS NULL)
    BEGIN
        SELECT MESSAGE_SEQUENCE.NEXTVAL INTO :NEW.ID FROM DUAL;
    END;

################################### PETICIONES DE CLIENT ############

-- PETICIÓN GET
SELECT * FROM CLIENTE

-- PETICIÓN POST
BEGIN
    INSERT INTO CLIENTE
    (ID, NAME, EMAIL, AGE)
    VALUES(:id, :name, :email, :age);
    :status_code:=201;
END;

-- PETICION PUT
BEGIN
    UPDATE CLIENTE
    SET ID = :id, NAME = :name, EMAIL = :email, AGE = :age;
    :status_code:=201;
END;

-- PETICION DELETE
BEGIN
    DELETE FROM CLIENTE
    WHERE ID = id;
    :status_code:=204;
END;

-- PETICION GET PARA UN USUARIO EN PARTICULAR
SELECT * FROM CLIENTE WHERE ID = :id;

################## PETICIONES MESSAGE #######################

-- PETICON GET
SELECT * FROM MENSAJE

-- PETICION POST
BEGIN
    INSERT INTO MENSAJE
    (ID, MESSAGETEXT)
    VALUES(:id, :messagetext);
    :status_code:=201;
END;

-- PETICON PUT
BEGIN
    UPDATE MENSAJE
    SET ID = :id, MESSAGETEXT = :messagetext;
    :status_code:=201;
END;

-- PETICION DELETE
BEGIN
    DELETE FROM MENSAJE WHERE ID = :id;
    :status_code:=204;
END;

-- PETICION GET PARA UN ID EN ESPECIFICO
SELECT * FROM MENSAJE WHERE ID = :id